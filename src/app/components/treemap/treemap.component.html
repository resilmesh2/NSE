<div class="treemap-wrapper">
  <!-- Show organization filter status -->
  <div class="organization-filter" *ngIf="selectedOrganization || showingAutomations">
  <div class="filter-header">
    <h4 *ngIf="selectedOrganization">{{ selectedOrganization.name }} - Subnets</h4>
    <h4 *ngIf="showingAutomations">Active Automations</h4>
    <button class="btn btn-sm btn-secondary" 
            (click)="showingAutomations ? clearAutomationView() : clearOrganizationFilter()">
      ‚Üê Back to All {{ showingAutomations ? 'Networks' : 'Organizations' }}
    </button>
  </div>
  <div class="filter-stats" *ngIf="selectedOrganization">
    <span>{{ networkData.length }} subnets</span>
    <span>{{ selectedOrganization.totalDevices }} devices</span>
    <span>{{ selectedOrganization.avgRiskScore | number:'1.1-1' }} avg risk</span>
  </div>
  <div class="filter-stats" *ngIf="showingAutomations">
  <span>{{ automationData.length }} automations</span>
  <span>{{ getActiveAutomationsCount() }} active</span>
  <span>{{ getPausedAutomationsCount() }} paused</span>
</div>
</div>

  <!-- Regular treemap controls for non-filtered view -->
  <div class="treemap-controls" *ngIf="!selectedOrganization && !showingAutomations">
  <div class="control-group">
    <label>Group By:</label>
    <div class="btn-group">
      <button 
        [class.active]="groupBy === 'organization'"
        (click)="groupBy = 'organization'; onGroupByChange()"
        class="btn btn-sm">
        Organization
      </button>
      <button 
        [class.active]="groupBy === 'subnet'"
        (click)="groupBy = 'subnet'; onGroupByChange()"
        class="btn btn-sm">
        Subnet Range
      </button>
    </div>
  </div>
</div>
  
  <div #treemapContainer class="treemap-container"></div>
  
  <!-- Pagination controls - show when not filtering by organization -->
<div class="pagination-controls" *ngIf="!selectedOrganization && totalOrgPages > 1 && !showingAutomations">
  <div class="pagination-info">{{ organizationPaginationInfo }}</div>
  <div class="pagination-buttons">
    <button (click)="prevOrgPage()" [disabled]="currentOrgPage === 1" class="btn btn-sm">
      Previous
    </button>
    <button *ngFor="let page of getOrgPageNumbers()" 
            (click)="goToOrgPage(page)"
            [class.active]="page === currentOrgPage"
            class="btn btn-sm page-number">
      {{ page }}
    </button>
    <button (click)="nextOrgPage()" [disabled]="currentOrgPage === totalOrgPages" class="btn btn-sm">
      Next
    </button>
  </div>
</div>

<!-- Automation pagination controls -->
<div class="pagination-controls" *ngIf="showingAutomations && totalAutomationPages > 1">
  <div class="pagination-info">{{ automationPaginationInfo }}</div>
  <div class="pagination-buttons">
    <button (click)="prevAutomationPage()" [disabled]="currentAutomationPage === 1" class="btn btn-sm">
      Previous
    </button>
    <button *ngFor="let page of getAutomationPageNumbers()" 
            (click)="goToAutomationPage(page)"
            [class.active]="page === currentAutomationPage"
            class="btn btn-sm page-number">
      {{ page }}
    </button>
    <button (click)="nextAutomationPage()" [disabled]="currentAutomationPage === totalAutomationPages" class="btn btn-sm">
      Next
    </button>
  </div>
</div>
</div>