<div class="treemap-wrapper">
  <!-- Show organization filter status -->
  <div class="organization-filter" *ngIf="showingAutomations">
    <div class="filter-header">
      <h4>Active Automations - Affected Targets</h4>
      <button class="btn btn-sm btn-secondary" (click)="clearAutomationView()">
        ‚Üê Back to Standard View
      </button>
    </div>
    <div class="filter-stats">
      <span>{{ automationTreemapData.length }} automations</span>
      <span>Multiple target types displayed</span>
    </div>
  </div>
    <div class="filter-stats">
      <span>{{ networkData.length }} subnets</span>
      <span>{{ selectedOrganization.totalDevices }} devices</span>
      <span>{{ selectedOrganization.avgRiskScore | number:'1.1-1' }} avg risk</span>
    </div>
  </div>

  <!-- Regular treemap controls for non-filtered view -->
  <div class="treemap-controls" *ngIf="!selectedOrganization">
    <div class="control-group">
      <label>Group By:</label>
      <div class="btn-group">
        <button 
          [class.active]="groupBy === 'organization'"
          (click)="groupBy = 'organization'; onGroupByChange()"
          class="btn btn-sm">
          Organization
        </button>
        <button 
          [class.active]="groupBy === 'subnet'"
          (click)="groupBy = 'subnet'; onGroupByChange()"
          class="btn btn-sm">
          Subnet Range
        </button>
      </div>
    </div>
  </div>
  
  <div #treemapContainer class="treemap-container"></div>
  
  <!-- Pagination controls - show when not filtering by organization -->
  <div class="pagination-controls" *ngIf="totalOrgPages > 1 && !selectedOrganization">
    <div class="pagination-info">{{ organizationPaginationInfo }}</div>
    <div class="pagination-buttons">
      <button (click)="prevOrgPage()" [disabled]="currentOrgPage === 1" class="btn btn-sm">
        Previous
      </button>
      <button *ngFor="let page of getOrgPageNumbers()" 
              (click)="goToOrgPage(page)"
              [class.active]="page === currentOrgPage"
              class="btn btn-sm page-number">
        {{ page }}
      </button>
      <button (click)="nextOrgPage()" [disabled]="currentOrgPage === totalOrgPages" class="btn btn-sm">
        Next
      </button>
    </div>
  </div>