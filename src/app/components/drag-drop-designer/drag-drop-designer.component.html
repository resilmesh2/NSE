<div class="risk-calculator-designer">
  <div class="designer-header">
    <h3>Risk Calculation Configurator</h3>
    <p>Customize how risk scores are calculated using ISIM data components</p>
    
    <div class="designer-actions">
      <button class="btn btn-outline" (click)="saveCurrentFormulaAsCustom()" [disabled]="riskFormula.length === 0">
        Save as Custom Formula
      </button>
      <button class="btn btn-secondary" (click)="clearFormula()">Clear Formula</button>
      <button class="btn btn-primary" (click)="saveConfiguration()">Save Configuration</button>
      <button class="btn btn-success" (click)="testConfiguration()">Test on Sample Data</button>
    </div>
  </div>

  <div class="designer-workspace">
    <!-- Enhanced Components Palette with Toggle -->
    <div class="components-palette">
      <!-- Dynamic Header with Toggle -->
      <div class="palette-header">
        <h4>{{ showingFormulas ? 'Available Formulas' : 'Available Risk Components' }}</h4>
        <button 
          class="btn btn-outline btn-sm toggle-view-btn" 
          (click)="toggleView()">
          {{ toggleButtonText }}
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="(showingFormulas && isLoadingFormulas) || (!showingFormulas && isLoadingComponents)" 
           class="loading-state">
        <div class="loading-spinner"></div>
        <div class="loading-text">
          {{ showingFormulas ? 'Loading Formulas...' : 'Loading Components...' }}
        </div>
      </div>

      <!-- FORMULAS VIEW -->
      <div *ngIf="showingFormulas && !isLoadingFormulas" class="formulas-list">
        
        <!-- Active Formula Display -->
        <div class="active-formula-indicator" *ngIf="activeFormula">
          <div class="active-label">Currently Active:</div>
          <div class="active-formula-name">{{ activeFormula.name }}</div>
          <div class="active-formula-type">{{ activeFormula.type.toUpperCase() }}</div>
        </div>

        <!-- Predefined Formulas -->
        <div class="formula-category" *ngIf="predefinedFormulas.length > 0">
          <h5>Predefined Formulas</h5>
          <div 
            *ngFor="let formula of predefinedFormulas" 
            class="formula-item"
            [class.active-formula]="isActiveFormula(formula)"
            (click)="loadFormulaFromLeftPanel(formula)">
            
            <div class="formula-header">
              <div class="formula-name">{{ formula.name }}</div>
              <div class="formula-badge predefined">PREDEFINED</div>
            </div>
            
            <div class="formula-description">{{ formula.description }}</div>
            
            <div class="formula-components-mini">
              <span *ngFor="let component of getFormulaComponentsArray(formula)" 
                    class="component-mini">
                {{ getComponentDisplayName(component.key) }}: {{ (component.value * 100).toFixed(0) }}%
              </span>
            </div>
            
            <div class="formula-actions">
              <button 
                class="btn btn-success btn-xs" 
                (click)="setActiveFormula(formula); $event.stopPropagation()"
                [disabled]="isActiveFormula(formula)">
                {{ isActiveFormula(formula) ? 'Active' : 'Set Active' }}
              </button>
            </div>
          </div>
        </div>

        <!-- Custom Formulas -->
        <div class="formula-category" *ngIf="customFormulas.length > 0">
          <h5>Custom Formulas</h5>
          <div 
            *ngFor="let formula of customFormulas" 
            class="formula-item custom-formula"
            [class.active-formula]="isActiveFormula(formula)"
            (click)="loadFormulaFromLeftPanel(formula)">
            
            <div class="formula-header">
              <div class="formula-name">{{ formula.name }}</div>
              <div class="formula-badge custom">CUSTOM</div>
            </div>
            
            <div class="formula-description">{{ formula.description }}</div>
            
            <div class="formula-components-mini">
              <span *ngFor="let component of getFormulaComponentsArray(formula)" 
                    class="component-mini">
                {{ getComponentDisplayName(component.key) }}: {{ (component.value * 100).toFixed(0) }}%
              </span>
            </div>
            
            <div class="formula-actions">
              <button 
                class="btn btn-success btn-xs" 
                (click)="setActiveFormula(formula); $event.stopPropagation()"
                [disabled]="isActiveFormula(formula)">
                {{ isActiveFormula(formula) ? 'Active' : 'Set Active' }}
              </button>
              <button 
                class="btn btn-danger btn-xs" 
                (click)="deleteCustomFormula(formula); $event.stopPropagation()">
                Delete
              </button>
            </div>
          </div>
        </div>

        <!-- No Formulas State -->
        <div *ngIf="predefinedFormulas.length === 0 && customFormulas.length === 0" class="no-formulas">
          <div class="empty-icon">📋</div>
          <p>No formulas available</p>
          <button class="btn btn-outline btn-sm" (click)="toggleView()">
            Create Custom Formula
          </button>
        </div>
      </div>

      <!-- COMPONENTS VIEW - Always render but hide when showing formulas -->
      <div [style.display]="showingFormulas ? 'none' : 'block'" class="components-list">
        
        <!-- Show loading in components view -->
        <div *ngIf="isLoadingComponents" class="loading-state">
          <div class="loading-spinner"></div>
          <div class="loading-text">Loading Components...</div>
        </div>

        <!-- Components Grid -->
        <div class="component-list" 
            cdkDropList 
            #componentList="cdkDropList"
            [cdkDropListData]="availableComponents"
            [cdkDropListConnectedTo]="[formulaArea]"
            (cdkDropListDropped)="drop($event)">
          
          <!-- Show components only when not loading -->
          <ng-container *ngIf="!isLoadingComponents">
            <div *ngFor="let component of availableComponents" 
                class="component-item" 
                [attr.data-type]="component.type"
                cdkDrag>
              <div class="component-preview">
                <span class="component-icon">{{component.icon}}</span>
                <div class="component-info">
                  <span class="component-name">{{component.name}}</span>
                  <span class="component-desc">{{component.description}}</span>
                  <span class="component-type">{{component.type.toUpperCase()}}</span>
                  
                  <!-- Show if composite -->
                  <div *ngIf="component.isComposite" class="component-composite">
                    Composite: {{component.compositeOf?.join(' + ')}}
                  </div>
                  
                  <!-- Show statistics -->
                  <div class="component-stats">
                    {{getComponentStatistics(component)}}
                  </div>
                  
                  <!-- Show ISIM property -->
                  <div class="component-property">
                    Property: {{component.neo4jProperty}}
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- Calculation Methods - RESTORED! -->
        <div *ngIf="!isLoadingComponents" class="calculation-methods">
          <h5>Calculation Method</h5>
          <div class="method-selector">
            <div *ngFor="let method of availableMethods" 
                 class="method-option"
                 [class.selected]="selectedMethod === method.id"
                 (click)="onMethodChange(method.id)">
              <span class="method-icon">{{method.icon}}</span>
              <div class="method-info">
                <span class="method-name">{{method.name}}</span>
                <span class="method-desc">{{method.description}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Risk Formula Builder -->
    <div class="formula-builder">
      <h4>Risk Calculation Formula</h4>
      <div class="formula-area" 
           cdkDropList 
           #formulaArea="cdkDropList"
           [cdkDropListData]="riskFormula"
           [cdkDropListConnectedTo]="[componentList]"
           (cdkDropListDropped)="drop($event)">
        
        <div *ngFor="let component of riskFormula; let i = index" 
             class="formula-component" 
             cdkDrag>
          <div class="component-header">
            <span class="component-title">{{component.icon}} {{component.name}}</span>
            <button class="remove-btn" (click)="removeFromFormula(i)">×</button>
          </div>
          <div class="component-config">
            <div class="config-row">
              <label>Weight:</label>
              <input type="number" 
                    [value]="component.weight" 
                    (input)="updateWeight(component, $event)"
                    step="0.1" 
                    min="0" 
                    max="1"
                    class="weight-input">
            </div>
            <div class="config-row">
              <label>Max Value:</label>
              <input type="number" 
                    [value]="component.maxValue" 
                    (input)="updateMaxValue(component, $event)"
                    step="0.1" 
                    min="1" 
                    [max]="component.statistics?.max || 10"
                    class="weight-input">
            </div>
            <div class="config-row">
              <label>Current:</label>
              <input type="number" 
                    [value]="(component.currentValue || component.statistics?.avg || 0).toFixed(2)" 
                    (input)="updateCurrentValue(component, $event)"
                    step="0.1" 
                    min="0" 
                    [max]="component.maxValue"
                    class="weight-input">
            </div>
          </div>
        </div>

        <!-- Empty state -->
        <div *ngIf="riskFormula.length === 0" class="empty-formula">
          <div class="empty-icon">🧮</div>
          <h5>Build Your Risk Formula</h5>
          <p>Drag risk components from the left panel to create your custom calculation</p>
          <p class="empty-hint">Or load a predefined formula from above</p>
        </div>
      </div>

      <!-- Formula Preview -->
      <div class="formula-preview" *ngIf="riskFormula.length > 0">
        <h5>Formula Preview</h5>
        <div class="preview-calculation">
          <div class="calculation-display">
            <div class="method-label">{{selectedMethod.replace('_', ' ').toUpperCase()}}:</div>
            <div class="formula-expression">
              <span *ngIf="selectedMethod === 'weighted_avg'">
                {{getWeightedFormulaExpression()}}
              </span>
              <span *ngIf="selectedMethod === 'max'">
                {{getMaxFormulaExpression()}}
              </span>
              <span *ngIf="selectedMethod === 'sum'">
                {{getSumFormulaExpression()}}
              </span>
              <span *ngIf="selectedMethod === 'custom_formula'">
                <div class="custom-formula-input">
                  <label for="customFormulaField">Custom Formula:</label>
                  <textarea 
                    id="customFormulaField"
                    [(ngModel)]="customFormula"
                    placeholder="Components will auto-populate when dragged. Edit operators as needed."
                    class="form-control"
                    rows="2"
                    style="margin-top: 5px; font-family: 'Courier New', monospace; resize: vertical;">
                  </textarea>
                  
                  <div class="formula-hint" style="font-size: 11px; color: #666; margin-top: 5px;">
                    Components auto-populate with + operators. Edit manually for custom calculations.
                    <br>Example: <code>(CVSS Score * 0.6) + (Threat Score * 0.4)</code>
                    <span *ngIf="isCustomFormulaEdited()" style="color: #007bff; font-weight: bold;">
                      <br>✏️ Custom formula detected - sample result reflects your changes
                    </span>
                  </div>
                </div>
              </span>
              <span *ngIf="selectedMethod !== 'weighted_avg' && selectedMethod !== 'max' && selectedMethod !== 'sum' && selectedMethod !== 'custom_formula'">
                {{getGenericFormulaExpression()}}
              </span>
            </div>
          </div>
          <div class="result-preview">
            <span class="result-label">Sample Result:</span>
            <span class="result-value" [ngClass]="getResultRiskClass(calculatePreviewRisk())">
              {{calculatePreviewRisk().toFixed(2)}}
            </span>
          </div>
        </div>
        
        <!-- Formula Summary -->
        <div class="formula-summary" *ngIf="riskFormula.length > 0">
          <div class="total-weight">
            <strong>Total Weight: {{ getTotalWeight().toFixed(3) }}</strong>
            <span 
              class="weight-status" 
              [class.valid]="isValidWeight()" 
              [class.invalid]="!isValidWeight()">
              {{ isValidWeight() ? 'Valid' : 'Must equal 1.0' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Configuration Panel -->
    <div class="config-panel">
      <h4>Configuration</h4>
      
      <div class="config-section">
        <label>Risk Scale:</label>
        <select class="form-control">
          <option>0-10 Scale</option>
          <option>0-100 Scale</option>
          <option>1-5 Scale</option>
          <option>Custom Scale</option>
        </select>
      </div>

      <div class="config-section">
        <label>Normalization:</label>
        <select class="form-control">
          <option>Auto Normalize</option>
          <option>Manual Scaling</option>
          <option>No Normalization</option>
        </select>
      </div>

      <div class="config-section">
        <label>Thresholds:</label>
        <div class="threshold-inputs">
          <div class="threshold-item">
            <span>Low:</span>
            <input type="number" value="3" class="threshold-input">
          </div>
          <div class="threshold-item">
            <span>Medium:</span>
            <input type="number" value="6" class="threshold-input">
          </div>
          <div class="threshold-item">
            <span>High:</span>
            <input type="number" value="8" class="threshold-input">
          </div>
        </div>
      </div>

      <div class="config-section">
        <label>Update Frequency:</label>
        <select class="form-control">
          <option>Real-time</option>
          <option>Hourly</option>
          <option>Daily</option>
          <option>Manual</option>
        </select>
      </div>

      <div class="config-section">
        <label>Target Property:</label>
        <select class="form-control" [(ngModel)]="targetProperty">
          <option value="Risk Score">Risk Score</option>
          <option value="Custom Risk">Custom Risk</option>
          <option *ngFor="let comp of riskFormula" [value]="comp.neo4jProperty">{{comp.name}}</option>
        </select>
      </div>

      <div class="config-section">
        <label>Custom Components:</label>
        <button class="btn btn-outline" (click)="addCustomComponent()">+ Add Custom</button>
      </div>

      <div class="preview-section">
        <h5>Impact Preview</h5>
        <div class="impact-stats">
          <div class="stat-item">
            <span class="stat-label">Components:</span>
            <span class="stat-value">{{getComponentCount()}}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Weight:</span>
            <span class="stat-value">{{getTotalWeight().toFixed(2)}}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Method:</span>
            <span class="stat-value">{{getSelectedMethodDisplay()}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- All your existing modals stay the same... -->
<!-- Configuration Application Modal -->
<div class="modal-overlay" *ngIf="showConfigModal" (click)="closeConfigModal()">
  <div class="config-modal" (click)="$event.stopPropagation()">
    <div class="config-modal-header">
      <h3>Apply Risk Configuration</h3>
      <button (click)="closeConfigModal()" class="close-btn">×</button>
    </div>
    <div class="config-modal-content">
      <p>Choose where to apply your custom risk calculation:</p>
      <div class="apply-options">
        <div class="apply-option" (click)="selectApplyOption('network')">
          <div class="option-icon">🌐</div>
          <div class="option-info">
            <div class="option-title">Entire Network</div>
            <div class="option-desc">Apply to a specific network range (e.g., 192.168.x.x)</div>
          </div>
        </div>
        
        <div class="apply-option" (click)="selectApplyOption('subnet')">
          <div class="option-icon">🏠</div>
          <div class="option-info">
            <div class="option-title">Specific Subnet</div>
            <div class="option-desc">Apply to a single subnet</div>
          </div>
        </div>
        
        <div class="apply-option" (click)="selectApplyOption('ip')">
          <div class="option-icon">💻</div>
          <div class="option-info">
            <div class="option-title">Specific IP Address</div>
            <div class="option-desc">Apply to individual IP addresses/devices</div>
          </div>
        </div>
        
        <div class="apply-option" (click)="selectApplyOption('sample')">
          <div class="option-icon">🎲</div>
          <div class="option-info">
            <div class="option-title">Random Sample</div>
            <div class="option-desc">Apply to 10 random subnets to see the effect</div>
          </div>
        </div>
      </div>
            
      <div class="modal-actions">
        <button (click)="closeConfigModal()" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Network Selection Modal -->
<div class="modal-overlay" *ngIf="showNetworkModal" (click)="closeNetworkModal()">
  <div class="selector-modal" (click)="$event.stopPropagation()">
    <div class="selector-modal-header">
      <h3>Select Network Ranges</h3>
      <button (click)="closeNetworkModal()" class="close-btn">×</button>
    </div>
    <div class="selector-modal-content">
      <p>Choose network ranges to apply your risk calculation (multiple selections allowed):</p>
      
      <div style="margin-bottom: 15px;">
        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
          <input type="checkbox" 
                 [(ngModel)]="selectAllNetworks" 
                 [indeterminate]="isSelectAllIndeterminate()"
                 (change)="toggleAllNetworks($event)" 
                 style="margin: 0; transform: scale(1.2);">
          <strong>Select All Networks</strong>
        </label>
      </div>
      
      <div class="network-options">
        <label *ngFor="let network of availableNetworks; let i = index" 
               class="network-option-checkbox" 
               [class.selected]="selectedNetworks[i]"
               style="display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #dee2e6; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s ease;"
               [style.border-color]="selectedNetworks[i] ? '#007bff' : '#dee2e6'"
               [style.background-color]="selectedNetworks[i] ? '#f8f9fa' : 'white'">
          <input type="checkbox" 
                 [(ngModel)]="selectedNetworks[i]"
                 (change)="updateNetworkSelection()"
                 style="margin: 0; transform: scale(1.2);">
          <div style="flex: 1;">
            <div class="network-name" style="font-weight: 600; color: #333; margin-bottom: 4px;">{{network.prefix}}.x.x</div>
            <div class="network-stats" style="font-size: 12px; color: #666;">{{network.subnets.length}} subnets, {{network.totalDevices}} devices</div>
          </div>
        </label>
      </div>
      
      <div class="modal-actions" style="margin-top: 20px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #eee; padding-top: 15px;">
        <span class="selection-count" style="font-size: 14px; color: #666;">{{getSelectionCountText()}}</span>
        <div>
          <button (click)="closeNetworkModal()" class="btn btn-secondary" style="margin-right: 10px;">Cancel</button>
          <button (click)="applyToSelectedNetworks()" 
                  [disabled]="getSelectedNetworksCount() === 0" 
                  class="btn btn-primary">Apply Configuration</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Subnet Selection Modal -->
<div class="modal-overlay" *ngIf="showSubnetModal" (click)="closeSubnetModal()">
  <div class="selector-modal" (click)="$event.stopPropagation()">
    <div class="selector-modal-header">
      <h3>Select Specific Subnet</h3>
      <button (click)="closeSubnetModal()" class="close-btn">×</button>
    </div>
    <div class="selector-modal-content">
      <p>Choose a subnet to apply your risk calculation (showing first 20):</p>
      <div class="subnet-options">
        <div *ngFor="let subnet of availableSubnets" 
             class="subnet-option" 
             (click)="applyToSubnet(subnet)">
          <div class="subnet-name">{{subnet.subnet}}</div>
          <div class="subnet-stats">{{subnet.deviceCount}} devices, Current Risk: {{subnet.riskScore.toFixed(1)}}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- IP Selection Modal -->
<div class="modal-overlay" *ngIf="showIpModal" (click)="closeIpModal()">
  <div class="selector-modal" (click)="$event.stopPropagation()">
    <div class="selector-modal-header">
      <h3>Select Specific IP Addresses</h3>
      <button (click)="closeIpModal()" class="close-btn">×</button>
    </div>
    <div class="selector-modal-content">
      <p>Choose specific IP addresses to apply your risk calculation (showing first 50 IPs):</p>
      
      <div style="margin-bottom: 15px;">
        <input type="text" 
               [(ngModel)]="ipSearchTerm" 
               (input)="filterIpAddresses()"
               placeholder="Search IP addresses..." 
               style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; cursor: pointer;">
          <input type="checkbox" 
                 [(ngModel)]="selectAllIps" 
                 [indeterminate]="isSelectAllIpsIndeterminate()"
                 (change)="toggleAllIps($event)" 
                 style="margin: 0; transform: scale(1.2);">
          <strong>Select All IPs</strong>
        </label>
      </div>
      
      <div class="ip-options" style="max-height: 300px; overflow-y: auto;">
        <label *ngFor="let ip of filteredIpAddresses; let i = index" 
               class="ip-option-checkbox" 
               [class.selected]="selectedIps[i]"
               style="display: flex; align-items: center; gap: 12px; padding: 10px; border: 1px solid #dee2e6; border-radius: 6px; margin-bottom: 6px; cursor: pointer; transition: all 0.2s ease;"
               [style.border-color]="selectedIps[i] ? '#007bff' : '#dee2e6'"
               [style.background-color]="selectedIps[i] ? '#f8f9fa' : 'white'">
          <input type="checkbox" 
                 [(ngModel)]="selectedIps[i]"
                 (change)="updateIpSelection()"
                 style="margin: 0; transform: scale(1.1);">
          <div style="flex: 1;">
            <div class="ip-address" style="font-weight: 600; color: #333; font-family: 'Courier New', monospace;">{{ip.ip}}</div>
            <div class="ip-details" style="font-size: 11px; color: #666;">{{ip.subnet}} | Risk: {{ip.riskScore?.toFixed(1) || '0.0'}}</div>
          </div>
        </label>
      </div>
      
      <div class="modal-actions" style="margin-top: 20px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #eee; padding-top: 15px;">
        <span class="selection-count" style="font-size: 14px; color: #666;">{{getSelectedIpsCountText()}}</span>
        <div>
          <button (click)="closeIpModal()" class="btn btn-secondary" style="margin-right: 10px;">Cancel</button>
          <button (click)="applyToSelectedIps()" 
                  [disabled]="getSelectedIpsCount() === 0" 
                  class="btn btn-primary">Apply Configuration</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom Component Modal -->
<div class="modal-overlay" *ngIf="showCustomComponentModal" (click)="closeCustomComponentModal()">
  <div class="custom-component-modal" (click)="$event.stopPropagation()">
    <div class="custom-component-modal-header">
      <h3>Add Custom Risk Component</h3>
      <button (click)="closeCustomComponentModal()" class="close-btn">×</button>
    </div>
    <div class="custom-component-modal-content">
      <form (ngSubmit)="saveCustomComponent()" #customForm="ngForm">
        <div class="form-group">
          <label for="componentName">Component Name *</label>
          <input 
            type="text" 
            id="componentName"
            name="componentName"
            [(ngModel)]="customComponent.name"
            #componentName="ngModel"
            required
            maxlength="50"
            placeholder="e.g., Network Latency Score"
            class="form-input">
          <div class="form-hint">A descriptive name for your risk component</div>
          <div *ngIf="componentName.invalid && componentName.touched" class="form-error">
            Component name is required
          </div>
        </div>

        <div class="form-group">
          <label for="componentCategory">Component Category *</label>
          <select 
            id="componentCategory"
            name="componentCategory"
            [(ngModel)]="customComponent.category"
            #componentCategory="ngModel"
            required
            class="form-input">
            <option value="">Select Category</option>
            <option value="security">Security Risk</option>
            <option value="performance">Performance Impact</option>
            <option value="compliance">Compliance Score</option>
            <option value="business">Business Impact</option>
            <option value="technical">Technical Metric</option>
            <option value="custom">Custom Calculation</option>
          </select>
          <div class="form-hint">Categorize this component for better organization</div>
          <div *ngIf="componentCategory.invalid && componentCategory.touched" class="form-error">
            Category is required
          </div>
        </div>

        <div class="form-group">
          <label for="componentMaxValue">Maximum Value *</label>
          <input 
            type="number" 
            id="componentMaxValue"path
            name="componentMaxValue"
            [(ngModel)]="customComponent.maxValue"
            #componentMaxValue="ngModel"
            required
            min="1"
            max="10"
            step="0.1"
            class="form-input">
          <div class="form-hint">The highest possible score for this component (1-10)</div>
          <div *ngIf="componentMaxValue.invalid && componentMaxValue.touched" class="form-error">
            Max value must be between 1 and 10
          </div>
        </div>

        <div class="preview-section">
        <h5>Component Preview</h5>
        <div class="component-preview-card">
          <div class="preview-icon">{{getCategoryIcon(customComponent.category)}}</div>
          <div class="preview-details">
            <div class="preview-name">{{customComponent.name || 'Component Name'}}</div>
            <div class="preview-desc">{{getAutoDescription()}}</div>
            <div class="preview-type">{{(customComponent.category || 'CATEGORY').toUpperCase()}}</div>
          </div>
          <div class="preview-values">
            <div class="preview-value">Max: {{customComponent.maxValue}}</div>
            <div class="preview-value">Weight: 0.2</div>
          </div>
        </div>
      </div>

        <div class="modal-actions">
          <button type="button" (click)="closeCustomComponentModal()" class="btn btn-secondary">Cancel</button>
          <button type="submit" [disabled]="customForm.invalid" class="btn btn-primary">Add Component</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
  <div class="confirmation-modal" (click)="$event.stopPropagation()">
    <div class="confirmation-modal-header">
      <h3>{{confirmModalData.title}}</h3>
    </div>
    <div class="confirmation-modal-content">
      <div class="confirmation-message" [innerHTML]="confirmModalData.message"></div>
    </div>
    <div class="confirmation-modal-actions">
      <button (click)="confirmModalData.onCancel()" class="btn btn-secondary">{{confirmModalData.cancelText}}</button>
      <button *ngIf="confirmModalData.thirdButtonText" (click)="confirmModalData.onThirdButton?.()" class="btn btn-outline">{{confirmModalData.thirdButtonText}}</button>
      <button (click)="confirmModalData.onConfirm()" class="btn btn-primary">{{confirmModalData.confirmText}}</button>
    </div>
  </div>
</div>

<!-- Alert Modal -->
<div class="modal-overlay" *ngIf="showAlertModal" (click)="closeAlertModal()">
  <div class="alert-modal" (click)="$event.stopPropagation()">
    <div class="alert-modal-header">
      <h3>{{alertModalData.title}}</h3>
    </div>
    <div class="alert-modal-content">
      <div class="alert-message" [innerHTML]="alertModalData.message"></div>
    </div>
    <div class="alert-modal-actions">
      <button (click)="alertModalData.onClose()" class="btn btn-primary">{{alertModalData.buttonText}}</button>
    </div>
  </div>
</div>

<!-- Toast Notifications -->
<div class="notification-container">
  <div *ngFor="let notification of notifications" 
       class="notification"
       [ngClass]="'notification-' + notification.type">
    <div class="notification-header">
      <span class="notification-icon">{{getNotificationIcon(notification.type)}}</span>
      <span class="notification-title">{{notification.title}}</span>
      <button class="notification-close" (click)="dismissNotification(notification.id)">×</button>
    </div>
    <div class="notification-message">{{notification.message}}</div>
  </div>
</div>