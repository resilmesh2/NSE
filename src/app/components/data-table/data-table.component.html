<div class="table-view">
  <div class="controls">
    <input 
      type="text" 
      [(ngModel)]="searchTerm"
      (input)="onSearchChange()"
      [placeholder]="viewMode === 'organizations' ? 'Search organizations...' : 'Search table...'" />
    
    <select [(ngModel)]="filterType" (change)="onFilterChange()">
      <option value="all">All Subnets</option>
      <option value="high-risk">High Risk Only</option>
      <option value="large">Large Subnets (>500 devices)</option>
      <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
      <option value="organizations">üìÅ View Organizations</option>
    </select>
  </div>

  <div class="table-container">
    <!-- Subnet table when viewing subnets -->
    <table class="subnet-table" *ngIf="viewMode === 'subnets'">
      <thead>
        <tr>
          <th class="sortable" (click)="sort('subnet')">
            Subnet 
            <span class="sort-indicator">
              {{sortField === 'subnet' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('deviceCount')">
            Devices 
            <span class="sort-indicator">
              {{sortField === 'deviceCount' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('riskScore')">
            Risk Score 
            <span class="sort-indicator">
              {{sortField === 'riskScore' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('riskLevel')">
            Risk Level 
            <span class="sort-indicator">
              {{sortField === 'riskLevel' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of paginatedData" 
            (click)="showSubnetDetails(item)"
            (mouseenter)="showTooltip($event, item)" 
            (mouseleave)="hideTooltip()">
          <td>{{ item.subnet }}</td>
          <td>{{ item.deviceCount }}</td>
          <td>
            <span [class]="'risk-' + item.riskLevel.toLowerCase()">
              {{ item.riskScore | number:'1.1-1' }}
            </span>
          </td>
          <td>
            <span [class]="'badge badge-' + item.riskLevel.toLowerCase()">
              {{ item.riskLevel }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- Organization table when viewing organizations -->
    <table class="subnet-table" *ngIf="viewMode === 'organizations'">
      <thead>
        <tr>
          <th class="sortable" (click)="sort('name')">
            Organization
            <span class="sort-indicator">
              {{sortField === 'name' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('totalSubnets')">
            Subnets
            <span class="sort-indicator">
              {{sortField === 'totalSubnets' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('totalDevices')">
            Total Devices
            <span class="sort-indicator">
              {{sortField === 'totalDevices' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th class="sortable" (click)="sort('avgRiskScore')">
            Avg Risk Score
            <span class="sort-indicator">
              {{sortField === 'avgRiskScore' ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : ''}}
            </span>
          </th>
          <th>High Risk Subnets</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let org of paginatedData" 
          (click)="onOrganizationRowClick(org)"
          (mouseenter)="showOrganizationTooltip($event, org)" 
          (mouseleave)="hideTooltip()"
          (mousedown)="hideTooltip()"
          class="organization-row clickable">
          <td><strong>{{ org.name }}</strong></td>
          <td>{{ org.totalSubnets }}</td>
          <td>{{ org.totalDevices }}</td>
          <td>
            <span [class]="'risk-' + getRiskLevel(org.avgRiskScore).toLowerCase()">
              {{ org.avgRiskScore | number:'1.1-1' }}
            </span>
          </td>
          <td>
            <span class="high-risk-count" *ngIf="org.highRiskSubnets > 0">
              {{ org.highRiskSubnets }} subnets
            </span>
            <span class="no-risk" *ngIf="org.highRiskSubnets === 0">None</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="pagination-container">
    <div class="pagination-info">
      {{paginationInfo}}
    </div>
    
    <div class="pagination-controls">
      <div class="pagination-select">
        <label>Show:</label>
        <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
        <span>entries</span>
      </div>
      
      <div class="pagination-buttons">
        <button 
          class="pagination-btn" 
          (click)="goToPage(1)"
          [disabled]="currentPage === 1">
          First
        </button>
        <button 
          class="pagination-btn" 
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1">
          Previous
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()"
          class="pagination-btn"
          [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{page}}
        </button>
        
        <button 
          class="pagination-btn" 
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages">
          Next
        </button>
        <button 
          class="pagination-btn" 
          (click)="goToPage(totalPages)"
          [disabled]="currentPage === totalPages">
          Last
        </button>
      </div>
    </div>
  </div>
</div>